<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Product Orders Tracking</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;background:#fff5f1;color:#1e293b;overflow-x:hidden;}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:#fed7aa;border-radius:3px;}
.hidden{display:none!important;}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
nav{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:64px;background:#fff;border-bottom:1.5px solid #fed7aa;position:sticky;top:0;z-index:100;}
.nav-left{display:flex;align-items:center;gap:14px;}
.back-btn{display:inline-flex;align-items:center;gap:6px;background:#fff7ed;border:1.5px solid#fed7aa;color:#c2410c;font-family:'Plus Jakarta Sans',sans-serif;font-size:0.8rem;font-weight:700;padding:7px 16px;border-radius:10px;cursor:pointer;transition:all 0.2s;text-decoration:none;}
.back-btn:hover{background:#ffedd5;}
.nav-logo{display:flex;align-items:center;gap:10px;}
.logo-icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#f59e0b,#ea580c);display:flex;align-items:center;justify-content:center;font-size:1rem;box-shadow:0 4px 12px rgba(245,158,11,0.3);}
.nav-title{font-size:1rem;font-weight:800;color:#1e293b;}
.tab-pills{display:flex;gap:4px;background:#fff5f1;border:1.5px solid #fed7aa;padding:4px;border-radius:12px;}
.tab-btn{background:none;border:none;color:#78350f;font-family:'Plus Jakarta Sans',sans-serif;font-size:0.82rem;font-weight:700;padding:8px 20px;border-radius:9px;cursor:pointer;transition:all 0.2s;}
.tab-btn.active{background:#fff;color:#ea580c;box-shadow:0 1px 6px rgba(0,0,0,0.08);}
.tab-btn:hover:not(.active){color:#1e293b;}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.page{display:none;max-width:860px;margin:0 auto;padding:36px 24px 80px;}
.page.active{display:block;animation:fadeUp 0.3s ease both;}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.section-header{background:#fff;border:1.5px solid #fed7aa;border-radius:18px;padding:20px 24px;margin-bottom:20px;display:flex;align-items:center;gap:16px;box-shadow:0 2px 8px rgba(245,158,11,0.07);}
.sh-icon{width:52px;height:52px;border-radius:14px;background:linear-gradient(135deg,#f59e0b,#ea580c);display:flex;align-items:center;justify-content:center;font-size:1.4rem;flex-shrink:0;box-shadow:0 4px 12px rgba(245,158,11,0.25);}
.sh-title{font-size:1.15rem;font-weight:800;color:#1e293b;margin-bottom:3px;}
.sh-sub{font-size:0.82rem;color:#64748b;}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{background:#fff;border:1.5px solid #e2e8f0;border-radius:18px;padding:24px 26px;margin-bottom:14px;box-shadow:0 2px 8px rgba(0,0,0,0.04);}
.section-label{font-size:0.68rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#c2410c;margin-bottom:16px;padding-bottom:10px;border-bottom:2px solid #ffedd5;display:flex;align-items:center;gap:8px;}
.section-label .dot{width:6px;height:6px;border-radius:50%;background:#f59e0b;}

/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.form-row{display:grid;gap:14px;margin-bottom:14px;}
.form-row.col2{grid-template-columns:1fr 1fr;}
.form-row.col1{grid-template-columns:1fr;}
label{font-size:0.76rem;font-weight:700;color:#374151;display:block;margin-bottom:5px;}
label .opt{font-weight:500;color:#94a3b8;font-size:0.7rem;}
input,select{width:100%;background:#f8fafc;border:1.5px solid #e2e8f0;color:#1e293b;font-family:'Plus Jakarta Sans',sans-serif;font-size:0.9rem;padding:11px 14px;border-radius:10px;outline:none;transition:all 0.2s;}
input:focus,select:focus{border-color:#f59e0b;background:#fff7ed;box-shadow:0 0 0 3px rgba(245,158,11,0.1);}
input::placeholder{color:#cbd5e1;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn-row{display:flex;gap:10px;margin-top:4px;}
.btn{font-family:'Plus Jakarta Sans',sans-serif;font-weight:700;font-size:0.88rem;padding:11px 24px;border-radius:10px;border:none;cursor:pointer;transition:all 0.2s;display:inline-flex;align-items:center;gap:7px;}
.btn-success{background:linear-gradient(135deg,#f59e0b,#ea580c);color:#fff;box-shadow:0 4px 14px rgba(245,158,11,0.3);}
.btn-success:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(245,158,11,0.4);}
.btn-success:disabled{opacity:0.7;transform:none;}
.btn-outline{background:#f8fafc;border:1.5px solid #e2e8f0;color:#64748b;}
.btn-outline:hover{background:#f1f5f9;color:#1e293b;}
.btn-danger{background:#fef2f2;border:1.5px solid #fecaca;color:#ef4444;font-size:0.8rem;padding:7px 14px;}
.btn-danger:hover{background:#fee2e2;}
.btn-sm{font-size:0.75rem;padding:7px 14px;}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.stat-card{background:#fff;border:1.5px solid #e2e8f0;border-radius:16px;padding:18px;box-shadow:0 1px 6px rgba(0,0,0,0.04);position:relative;overflow:hidden;}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.stat-total::before{background:linear-gradient(90deg,#f59e0b,#ea580c);}
.stat-pending::before{background:linear-gradient(90deg,#f59e0b,#fbbf24);}
.stat-urgent::before{background:linear-gradient(90deg,#ef4444,#f87171);}
.stat-delivered::before{background:linear-gradient(90deg,#10b981,#06b6d4);}
.stat-val{font-family:'JetBrains Mono',monospace;font-size:2rem;font-weight:700;line-height:1;margin-bottom:4px;}
.stat-total .stat-val{color:#f59e0b;}
.stat-pending .stat-val{color:#d97706;}
.stat-urgent .stat-val{color:#ef4444;}
.stat-delivered .stat-val{color:#10b981;}
.stat-lbl{font-size:0.72rem;font-weight:700;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;}

/* ‚îÄ‚îÄ ORDER ITEMS ‚îÄ‚îÄ */
.order-item{background:#fff;border:1.5px solid #e2e8f0;border-radius:16px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;position:relative;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,0.04);}
.order-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:4px 0 0 4px;}
.status-pending::before{background:#f59e0b;}
.status-urgent::before{background:#ef4444;}
.status-delivered::before{background:#10b981;}
.order-item:hover{border-color:#fed7aa;box-shadow:0 4px 16px rgba(245,158,11,0.1);transform:translateY(-1px);}
.order-item.expanded{border-color:#fbbf24;box-shadow:0 4px 20px rgba(245,158,11,0.12);}
.oi-top{padding:18px 20px 18px 24px;display:flex;justify-content:space-between;align-items:flex-start;gap:16px;}
.oi-contract{font-family:'JetBrains Mono',monospace;font-size:0.7rem;color:#f59e0b;margin-bottom:5px;font-weight:600;}
.oi-title{font-weight:800;font-size:0.98rem;color:#1e293b;margin-bottom:8px;}
.oi-tags{display:flex;gap:6px;flex-wrap:wrap;}
.tag{font-size:0.68rem;font-weight:700;padding:3px 10px;border-radius:20px;}
.tag-pending{background:#fef9c3;color:#854d0e;}
.tag-urgent{background:#fee2e2;color:#991b1b;}
.tag-delivered{background:#dcfce7;color:#166534;}
.tag-paid{background:#dbeafe;color:#1e40af;}
.tag-unpaid{background:#fee2e2;color:#991b1b;}
.days-chip{font-family:'JetBrains Mono',monospace;font-size:0.82rem;font-weight:700;padding:6px 14px;border-radius:20px;white-space:nowrap;flex-shrink:0;}
.days-pending{background:#fef9c3;color:#854d0e;}
.days-urgent{background:#fee2e2;color:#991b1b;}
.days-delivered{background:#dcfce7;color:#166534;}

/* ‚îÄ‚îÄ EXPANDED DETAIL ‚îÄ‚îÄ */
.oi-detail{display:none;padding:0 20px 18px 24px;border-top:1.5px solid#fff7ed;}
.oi-detail.show{display:block;animation:fadeUp 0.2s ease both;}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:14px;}
.dg-item{background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:10px 14px;}
.dg-lbl{font-size:0.66rem;color:#94a3b8;margin-bottom:3px;font-weight:700;letter-spacing:0.5px;text-transform:uppercase;}
.dg-val{font-size:0.88rem;font-weight:700;color:#1e293b;}
.oi-actions{display:flex;gap:8px;margin-top:12px;justify-content:flex-end;}

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.list-empty{text-align:center;padding:60px 20px;color:#94a3b8;}
.list-empty .icon{font-size:3rem;margin-bottom:14px;}

/* ‚îÄ‚îÄ BG BLOBS ‚îÄ‚îÄ */
.bg-blob{position:fixed;border-radius:50%;filter:blur(80px);pointer-events:none;z-index:0;}
.blob1{width:450px;height:450px;background:rgba(245,158,11,0.07);top:-100px;right:-80px;}
.blob2{width:350px;height:350px;background:rgba(251,191,36,0.05);bottom:-60px;left:-60px;}

@media(max-width:640px){
  nav{padding:0 16px;height:56px;}
  .page{padding:24px 16px 60px;}
  .form-row.col2{grid-template-columns:1fr;}
  .stats-row{grid-template-columns:1fr 1fr;}
  .detail-grid{grid-template-columns:1fr;}
  .tab-btn{padding:7px 12px;font-size:0.78rem;}
}
</style>
</head>
<body>

<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>

<div style="position:relative;z-index:1;">
<nav>
  <div class="nav-left">
    <a class="back-btn" href="index.html">‚Üê Home</a>
    <div class="nav-logo">
      <div class="logo-icon">üì¶</div>
      <span class="nav-title">Product Orders Tracking</span>
    </div>
  </div>
  <div class="tab-pills">
    <button class="tab-btn active" onclick="showTab('add',this)">‚ûï Add Order</button>
    <button class="tab-btn" onclick="showTab('list',this)">üìÑ All Orders</button>
  </div>
</nav>

<!-- ADD PAGE -->
<div class="page active" id="tab-add">
  <div class="section-header">
    <div class="sh-icon">üìù</div>
    <div>
      <div class="sh-title">Add New Order</div>
      <div class="sh-sub">Register a product order with auto-calculated delivery tracking.</div>
    </div>
  </div>
  <div class="card">
    <div class="section-label"><span class="dot"></span>Order Details</div>
    <div class="form-row col2">
      <div><label>Contract No.</label><input type="text" id="contractNo" placeholder="e.g. CNT-2025-001"/></div>
      <div><label>Order Date</label><input type="date" id="orderDate"/></div>
    </div>
    <div class="form-row col2">
      <div><label>Product Name</label><input type="text" id="productName" placeholder="e.g. Office Chairs"/></div>
      <div><label>Quantity</label><input type="text" id="quantity" placeholder="e.g. 50 units"/></div>
    </div>
    <div class="form-row col2">
      <div><label>Vendor Name</label><input type="text" id="vendorName" placeholder="e.g. XYZ Suppliers Pvt. Ltd."/></div>
      <div><label>Contract Price (‚Çπ)</label><input type="number" id="contractPrice" placeholder="e.g. 125000"/></div>
    </div>
    <div class="note-box" style="background:#fffbeb;border:1.5px solid #fde68a;border-radius:10px;padding:12px 16px;font-size:0.82rem;color:#92400e;margin-top:10px;">
      ‚ÑπÔ∏è Delivery must be completed within 15 days of order date. The system will alert you when delivery is due in &lt;5 days.
    </div>
  </div>
  <div class="btn-row">
    <button class="btn btn-success" onclick="saveOrder()">‚úì Save Order</button>
    <button class="btn btn-outline" onclick="clearForm()">‚úï Clear</button>
  </div>
</div>

<!-- LIST PAGE -->
<div class="page" id="tab-list">
  <div class="section-header">
    <div class="sh-icon">üìä</div>
    <div>
      <div class="sh-title">All Orders</div>
      <div class="sh-sub">Monitor pending orders, track delivery dates, and manage payments.</div>
    </div>
  </div>

  <div class="stats-row">
    <div class="stat-card stat-total">
      <div class="stat-val" id="statTotal">0</div>
      <div class="stat-lbl">Total</div>
    </div>
    <div class="stat-card stat-pending">
      <div class="stat-val" id="statPending">0</div>
      <div class="stat-lbl">Pending</div>
    </div>
    <div class="stat-card stat-urgent">
      <div class="stat-val" id="statUrgent">0</div>
      <div class="stat-lbl">Urgent (&lt;5d)</div>
    </div>
    <div class="stat-card stat-delivered">
      <div class="stat-val" id="statDelivered">0</div>
      <div class="stat-lbl">Delivered</div>
    </div>
  </div>

  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding:12px 18px;background:#fff;border:1.5px solid #e2e8f0;border-radius:12px;box-shadow:0 1px 4px rgba(0,0,0,0.04);">
    <span style="font-size:0.85rem;font-weight:700;color:#1e293b;"><span id="listCount" style="color:#f59e0b;">0</span> orders</span>
    <div style="display:flex;gap:8px;align-items:center;">
      <span id="sheetStatus" style="font-size:0.72rem;font-family:'JetBrains Mono',monospace;color:#f59e0b;"></span>
      <button class="btn btn-outline btn-sm" onclick="loadFromSheet()">‚Üª Sync Sheet</button>
    </div>
  </div>

  <div id="orderList"></div>
</div>
</div>

<script>
const SHEET_URL='https://script.google.com/macros/s/AKfycbyOyOcN3uCi2Igug1EHQ5dslfjHSqWIS7vG4V4zRGLutqhAa1VU7BLwmtUrh8HOg34R8Q/exec';
let orders=JSON.parse(localStorage.getItem('product_orders')||'[]');
let sheetLoaded=false;

// ‚îÄ‚îÄ SYNC FROM GOOGLE SHEET (JSONP) ‚îÄ‚îÄ
function loadFromSheet(){
  const st=document.getElementById('sheetStatus');
  const set=(msg,col)=>{if(!st)return;st.textContent=msg;st.style.color=col||'#f59e0b';};
  set('‚è≥ Syncing‚Ä¶','#d97706');
  const cbName='_cb'+Date.now();
  const script=document.createElement('script');
  let done=false;
  const cleanup=()=>{try{delete window[cbName];}catch(e){}try{if(script.parentNode)document.head.removeChild(script);}catch(e){}};
  const finish=(msg,col,data)=>{
    if(done)return;done=true;clearTimeout(timer);cleanup();
    set(msg,col);setTimeout(()=>set('',''),6000);
    sheetLoaded=true;
    if(data&&Array.isArray(data)&&data.length>0){orders=data;localStorage.setItem('product_orders',JSON.stringify(orders));}
    renderOrders();
  };
  const timer=setTimeout(()=>finish('‚è± Timed out','#ef4444',null),12000);
  window[cbName]=function(data){
    if(Array.isArray(data)&&data.length===0)return finish('üìã Sheet is empty','#d97706',data);
    if(!data||data.error)return finish('‚ö†Ô∏è Error: '+(data&&data.error||'unknown'),'#ef4444',null);
    finish('‚úÖ Synced '+data.length+' orders','#10b981',data);
  };
  script.addEventListener('error',()=>finish('‚ùå Script error','#ef4444',null));
  script.src=SHEET_URL+'?module=product&action=getAll&callback='+cbName;
  document.head.appendChild(script);
}

// ‚îÄ‚îÄ POST TO SHEET ‚îÄ‚îÄ
function postToSheet(entry,btn,origHTML){
  fetch(SHEET_URL,{method:'POST',body:JSON.stringify({module:'product',action:'save',...entry}),headers:{'Content-Type':'text/plain;charset=utf-8'},mode:'no-cors'})
  .then(()=>{btn.innerHTML='‚úÖ Sent to Sheet!';btn.style.background='linear-gradient(135deg,#f59e0b,#ea580c)';setTimeout(()=>{btn.innerHTML=origHTML;btn.style.background='';btn.disabled=false;},3000);})
  .catch(()=>{btn.innerHTML='üíæ Saved locally';setTimeout(()=>{btn.innerHTML=origHTML;btn.style.background='';btn.disabled=false;},2500);});
}

// ‚îÄ‚îÄ UPDATE STATUS IN SHEET ‚îÄ‚îÄ
function updateStatus(order,deliveryStatus,paymentStatus){
  fetch(SHEET_URL,{method:'POST',body:JSON.stringify({module:'product',action:'update',contractNo:order.contractNo,orderDate:order.orderDate,deliveryStatus,paymentStatus}),headers:{'Content-Type':'text/plain;charset=utf-8'},mode:'no-cors'})
  .catch(()=>{});
}

function showTab(name,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  if(el)el.classList.add('active');
  if(name==='list'){if(!sheetLoaded)loadFromSheet();else renderOrders();}
}

function calcDays(maxDeliveryDateStr){
  if(!maxDeliveryDateStr)return null;
  const today=new Date();today.setHours(0,0,0,0);
  const target=new Date(maxDeliveryDateStr);target.setHours(0,0,0,0);
  return Math.ceil((target-today)/86400000);
}

function saveOrder(){
  const contractNo=document.getElementById('contractNo').value.trim();
  const orderDate=document.getElementById('orderDate').value;
  const productName=document.getElementById('productName').value.trim();
  const quantity=document.getElementById('quantity').value.trim();
  const vendorName=document.getElementById('vendorName').value.trim();
  const contractPrice=document.getElementById('contractPrice').value;
  if(!contractNo){alert('Please enter Contract No.');return;}
  if(!orderDate){alert('Please select Order Date.');return;}
  if(!productName){alert('Please enter Product Name.');return;}
  if(!quantity){alert('Please enter Quantity.');return;}
  if(!vendorName){alert('Please enter Vendor Name.');return;}
  if(!contractPrice){alert('Please enter Contract Price.');return;}
  
  const od=new Date(orderDate);
  const maxDeliveryDate=new Date(od);
  maxDeliveryDate.setDate(maxDeliveryDate.getDate()+15);
  const maxDelStr=maxDeliveryDate.toISOString().split('T')[0];
  
  const entry={id:Date.now(),savedAt:new Date().toISOString(),contractNo,orderDate,productName,quantity,vendorName,contractPrice,maxDeliveryDate:maxDelStr,deliveryStatus:'Pending',paymentStatus:'Pending'};
  orders.unshift(entry);
  localStorage.setItem('product_orders',JSON.stringify(orders));
  const btn=document.querySelector('.btn-success');
  const orig=btn.innerHTML;
  btn.innerHTML='‚è≥ Saving‚Ä¶';btn.disabled=true;
  clearForm();
  postToSheet(entry,btn,orig);
}

function clearForm(){['contractNo','orderDate','productName','quantity','vendorName','contractPrice'].forEach(id=>document.getElementById(id).value='');}

function fmtDate(str){if(!str)return'‚Äî';try{return new Date(str).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});}catch(e){return str;}}

function renderOrders(){
  const list=document.getElementById('orderList');
  const today=new Date();today.setHours(0,0,0,0);
  
  const enriched=orders.map(o=>{
    const days=calcDays(o.maxDeliveryDate);
    let status='pending';
    if(o.deliveryStatus==='Delivered')status='delivered';
    else if(days!=null&&days<5&&days>=0)status='urgent';
    return{...o,daysRemaining:days,status};
  });
  
  document.getElementById('statTotal').textContent=enriched.length;
  document.getElementById('statPending').textContent=enriched.filter(o=>o.status==='pending').length;
  document.getElementById('statUrgent').textContent=enriched.filter(o=>o.status==='urgent').length;
  document.getElementById('statDelivered').textContent=enriched.filter(o=>o.status==='delivered').length;
  document.getElementById('listCount').textContent=enriched.length;
  
  if(!enriched.length){list.innerHTML=`<div class="list-empty"><div class="icon">üì¶</div><div style="font-weight:700;color:#374151;">No orders found.</div><p style="margin-top:6px;font-size:0.82rem;">Add an order or click Sync Sheet to load from Google Sheets.</p></div>`;return;}
  
  list.innerHTML='';
  enriched.forEach(o=>{
    const item=document.createElement('div');
    item.className=`order-item status-${o.status}`;item.id='oi_'+o.id;
    const delTag=o.deliveryStatus==='Delivered'?'<span class="tag tag-delivered">‚úÖ Delivered</span>':'<span class="tag tag-pending">‚è≥ Pending Delivery</span>';
    const payTag=o.paymentStatus==='Paid'?'<span class="tag tag-paid">üí∞ Paid</span>':'<span class="tag tag-unpaid">üí≥ Unpaid</span>';
    const daysText=o.status==='delivered'?'Delivered':(o.daysRemaining!=null?(o.daysRemaining<0?'Overdue':'Due in '+o.daysRemaining+'d'):'‚Äî');
    item.innerHTML=`
      <div class="oi-top" onclick="toggleExpand('${o.id}')">
        <div>
          <div class="oi-contract">üìÑ ${o.contractNo}</div>
          <div class="oi-title">${o.productName} ‚Äî ${o.quantity}</div>
          <div class="oi-tags">
            ${delTag}
            ${payTag}
            <span class="tag" style="background:#f0f9ff;color:#0369a1;">üìÖ Max Del: ${fmtDate(o.maxDeliveryDate)}</span>
          </div>
        </div>
        <div><div class="days-chip days-${o.status}">${daysText}</div></div>
      </div>
      <div class="oi-detail" id="oid_${o.id}">
        <div class="detail-grid">
          <div class="dg-item"><div class="dg-lbl">Contract No.</div><div class="dg-val">${o.contractNo}</div></div>
          <div class="dg-item"><div class="dg-lbl">Order Date</div><div class="dg-val">${fmtDate(o.orderDate)}</div></div>
          <div class="dg-item"><div class="dg-lbl">Product Name</div><div class="dg-val">${o.productName}</div></div>
          <div class="dg-item"><div class="dg-lbl">Quantity</div><div class="dg-val">${o.quantity}</div></div>
          <div class="dg-item"><div class="dg-lbl">Vendor Name</div><div class="dg-val">${o.vendorName}</div></div>
          <div class="dg-item"><div class="dg-lbl">Contract Price</div><div class="dg-val">‚Çπ${Number(o.contractPrice).toLocaleString('en-IN')}</div></div>
          <div class="dg-item"><div class="dg-lbl">Max Delivery Date</div><div class="dg-val">${fmtDate(o.maxDeliveryDate)}</div></div>
          <div class="dg-item"><div class="dg-lbl">Days Remaining</div><div class="dg-val" style="color:${o.status==='urgent'?'#ef4444':o.status==='delivered'?'#10b981':'#d97706'}">${daysText}</div></div>
        </div>
        <div class="oi-actions">
          <select id="del_${o.id}" style="font-size:0.8rem;padding:7px 12px;" onchange="updateDeliveryStatus('${o.id}',this.value)">
            <option value="" disabled selected>Delivery Status</option>
            <option value="Pending" ${o.deliveryStatus==='Pending'?'selected':''}>Pending</option>
            <option value="Delivered" ${o.deliveryStatus==='Delivered'?'selected':''}>Delivered</option>
          </select>
          <select id="pay_${o.id}" style="font-size:0.8rem;padding:7px 12px;" onchange="updatePaymentStatus('${o.id}',this.value)">
            <option value="" disabled selected>Payment Status</option>
            <option value="Pending" ${o.paymentStatus==='Pending'?'selected':''}>Pending</option>
            <option value="Sent to DDO" ${o.paymentStatus==='Sent to DDO'?'selected':''}>Sent to DDO for payment</option>
            <option value="Offline Payment" ${o.paymentStatus==='Offline Payment'?'selected':''}>Offline Payment processed</option>
          </select>
        </div>
      </div>`;
    list.appendChild(item);
  });
}

function toggleExpand(id){const detail=document.getElementById('oid_'+id);const item=document.getElementById('oi_'+id);const isOpen=detail.classList.contains('show');document.querySelectorAll('.oi-detail').forEach(d=>d.classList.remove('show'));document.querySelectorAll('.order-item').forEach(d=>d.classList.remove('expanded'));if(!isOpen){detail.classList.add('show');item.classList.add('expanded');}}

function updateDeliveryStatus(id,newStatus){
  const order=orders.find(o=>String(o.id)===String(id));
  if(!order)return;
  order.deliveryStatus=newStatus;
  localStorage.setItem('product_orders',JSON.stringify(orders));
  updateStatus(order,newStatus,order.paymentStatus);
  renderOrders();
}

function updatePaymentStatus(id,newStatus){
  const order=orders.find(o=>String(o.id)===String(id));
  if(!order)return;
  order.paymentStatus=newStatus;
  localStorage.setItem('product_orders',JSON.stringify(orders));
  updateStatus(order,order.deliveryStatus,newStatus);
  renderOrders();
}

window.addEventListener('DOMContentLoaded',()=>{renderOrders();loadFromSheet();});
</script>
</body>
</html>
