<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Taxi Bill Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:#07090f;color:#e2e8f0;min-height:100vh;line-height:1.5;overflow-x:hidden;}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:rgba(247,199,0,0.2);border-radius:3px;}

/* NAV */
.nav{display:flex;align-items:center;justify-content:space-between;padding:14px 40px;background:rgba(7,9,15,0.75);backdrop-filter:blur(20px);border-bottom:1px solid rgba(247,199,0,0.12);position:sticky;top:0;z-index:200;}
.nav-logo{display:flex;align-items:center;gap:10px;font-size:1rem;font-weight:700;color:#e2e8f0;}
.nav-logo .logo-icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#F7C700,#f59e0b);display:flex;align-items:center;justify-content:center;font-size:1.1rem;box-shadow:0 0 18px rgba(247,199,0,0.45);animation:cabGlow 2.5s ease-in-out infinite;}
@keyframes cabGlow{0%,100%{box-shadow:0 0 18px rgba(247,199,0,0.45);}50%{box-shadow:0 0 32px rgba(247,199,0,0.8);}}
.nav-logo .logo-sub{color:rgba(148,163,184,0.7);font-weight:500;font-size:0.8rem;}
.tab-btns{display:flex;gap:4px;background:rgba(247,199,0,0.05);padding:4px;border-radius:12px;border:1px solid rgba(247,199,0,0.1);}
.tab-btn{background:none;border:none;color:rgba(148,163,184,0.7);font-family:'Plus Jakarta Sans',sans-serif;font-size:0.82rem;font-weight:600;padding:8px 20px;border-radius:9px;cursor:pointer;transition:all 0.2s;}
.tab-btn.active{background:rgba(247,199,0,0.12);color:#F7C700;box-shadow:0 1px 4px rgba(0,0,0,0.3);}
.tab-btn:hover:not(.active){color:#e2e8f0;}

/* LAYOUT */
.page{display:none;max-width:840px;margin:0 auto;padding:36px 28px 80px;position:relative;z-index:10;}
.page.active{display:block;animation:fadeUp 0.4s cubic-bezier(.22,.68,0,1.2) both;}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.page-header{margin-bottom:28px;}
.page-title{font-size:1.65rem;font-weight:800;color:#f1f5f9;letter-spacing:-0.5px;margin-bottom:4px;}
.page-sub{color:rgba(148,163,184,0.6);font-size:0.88rem;}

/* FORM CARDS */
.form-card{background:rgba(7,9,15,0.88);backdrop-filter:blur(16px);border:1px solid rgba(247,199,0,0.1);border-radius:18px;padding:24px 26px;margin-bottom:16px;position:relative;overflow:hidden;transition:border-color 0.2s;}
.form-card:hover{border-color:rgba(247,199,0,0.2);}
.section-label{display:flex;align-items:center;gap:8px;font-size:0.68rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#F7C700;margin-bottom:18px;padding-bottom:12px;border-bottom:1px solid rgba(247,199,0,0.08);}
.section-label .dot{width:5px;height:5px;border-radius:50%;background:#F7C700;box-shadow:0 0 6px #F7C700;flex-shrink:0;}

.form-row{display:grid;gap:14px;margin-bottom:14px;}
.form-row.col2{grid-template-columns:1fr 1fr;}
.form-row.col3{grid-template-columns:1fr 1fr 1fr;}
.form-row.col1{grid-template-columns:1fr;}
label{font-size:0.76rem;font-weight:600;color:rgba(148,163,184,0.9);display:block;margin-bottom:5px;letter-spacing:0.2px;}
label .hint{font-weight:400;color:rgba(100,116,139,0.7);font-size:0.7rem;}
input,select{width:100%;background:rgba(255,255,255,0.04);border:1.5px solid rgba(247,199,0,0.1);color:#e2e8f0;font-family:'Plus Jakarta Sans',sans-serif;font-size:0.9rem;padding:11px 14px;border-radius:10px;outline:none;transition:all 0.2s;appearance:none;}
input:focus,select:focus{border-color:rgba(247,199,0,0.5);background:rgba(247,199,0,0.05);box-shadow:0 0 0 3px rgba(247,199,0,0.08);}
input::placeholder{color:rgba(100,116,139,0.5);}
select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23F7C700' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px;background-color:rgba(255,255,255,0.04);}
select option{background:#0f1626;color:#e2e8f0;}
.hidden{display:none!important;}

/* RESULT CARD */
.result-card{background:rgba(7,9,15,0.9);backdrop-filter:blur(16px);border:1px solid rgba(247,199,0,0.15);border-radius:18px;padding:24px;margin-bottom:16px;position:relative;overflow:hidden;}
.result-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,#F7C700,#f59e0b,#fbbf24);}
.result-title{font-size:0.68rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#F7C700;margin-bottom:18px;display:flex;align-items:center;gap:8px;}
.result-line{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid rgba(255,255,255,0.05);font-size:0.88rem;}
.result-line:last-of-type{border-bottom:none;}
.result-line .lbl{color:rgba(148,163,184,0.8);}
.result-line .val{font-family:'JetBrains Mono',monospace;font-weight:600;font-size:0.9rem;}
.result-line .val.green{color:#34d399;}
.result-line .val.yellow{color:#fbbf24;}
.result-line .val.red{color:#f87171;}
.divider-line{border:none;border-top:1px dashed rgba(255,255,255,0.07);margin:8px 0;}
.payable-row{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:rgba(247,199,0,0.07);border:1px solid rgba(247,199,0,0.2);border-radius:12px;margin-top:16px;}
.payable-row .lbl{font-weight:700;font-size:1rem;color:#e2e8f0;}
.payable-row .val{font-family:'JetBrains Mono',monospace;font-weight:800;font-size:1.5rem;color:#F7C700;}
.note-box{background:rgba(251,191,36,0.06);border:1px solid rgba(251,191,36,0.15);border-radius:10px;padding:12px 16px;font-size:0.82rem;color:#fcd34d;margin-top:14px;line-height:1.7;}
.note-box ul{margin-left:18px;}

/* BUTTONS */
.btn-row{display:flex;gap:10px;margin-top:20px;flex-wrap:wrap;}
.btn{font-family:'Plus Jakarta Sans',sans-serif;font-weight:700;font-size:0.88rem;padding:12px 24px;border-radius:10px;border:none;cursor:pointer;transition:all 0.2s;letter-spacing:0.2px;display:inline-flex;align-items:center;gap:7px;}
.btn-primary{background:linear-gradient(135deg,#F7C700,#f59e0b);color:#1a1000;box-shadow:0 4px 16px rgba(247,199,0,0.3);}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(247,199,0,0.45);}
.btn-success{background:linear-gradient(135deg,#10b981,#059669);color:#fff;box-shadow:0 4px 16px rgba(16,185,129,0.25);}
.btn-success:hover{transform:translateY(-1px);}
.btn-outline{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);color:rgba(148,163,184,0.8);}
.btn-outline:hover{background:rgba(255,255,255,0.08);color:#e2e8f0;}
.btn-danger{background:rgba(248,113,113,0.08);border:1px solid rgba(248,113,113,0.2);color:#f87171;font-size:0.78rem;padding:7px 14px;}
.btn-danger:hover{background:rgba(248,113,113,0.15);}

/* HISTORY */
.history-empty{text-align:center;padding:70px 20px;color:rgba(100,116,139,0.6);}
.history-empty .icon{font-size:3.5rem;margin-bottom:14px;opacity:0.4;}
.history-item{background:rgba(7,9,15,0.88);border:1px solid rgba(247,199,0,0.08);border-radius:16px;padding:20px 24px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;position:relative;overflow:hidden;}
.history-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:linear-gradient(180deg,#F7C700,#f59e0b);border-radius:3px 0 0 3px;}
.history-item:hover{background:rgba(10,12,20,0.95);border-color:rgba(247,199,0,0.18);transform:translateX(2px);}
.history-item.expanded{border-color:rgba(247,199,0,0.3);background:rgba(10,12,20,0.95);}
.hi-top{display:flex;justify-content:space-between;align-items:flex-start;gap:16px;}
.hi-meta{flex:1;}
.hi-bill{font-family:'JetBrains Mono',monospace;font-size:0.72rem;color:rgba(247,199,0,0.6);margin-bottom:5px;letter-spacing:0.5px;}
.hi-title{font-weight:700;font-size:1rem;color:#e2e8f0;margin-bottom:6px;}
.hi-tags{display:flex;gap:6px;flex-wrap:wrap;}
.tag{font-size:0.68rem;font-weight:700;padding:3px 10px;border-radius:20px;background:rgba(247,199,0,0.08);color:#fbbf24;border:1px solid rgba(247,199,0,0.15);}
.tag.green{background:rgba(52,211,153,0.08);color:#34d399;border-color:rgba(52,211,153,0.15);}
.tag.yellow{background:rgba(251,191,36,0.08);color:#fbbf24;border-color:rgba(251,191,36,0.15);}
.tag.teal{background:rgba(6,182,212,0.08);color:#22d3ee;border-color:rgba(6,182,212,0.15);}
.hi-amount{text-align:right;flex-shrink:0;}
.hi-amount .payable{font-family:'JetBrains Mono',monospace;font-size:1.3rem;font-weight:800;color:#F7C700;}
.hi-amount .label{font-size:0.7rem;color:rgba(100,116,139,0.7);margin-top:2px;}
.hi-detail{margin-top:18px;padding-top:18px;border-top:1px solid rgba(247,199,0,0.08);display:none;}
.hi-detail.show{display:block;animation:fadeUp 0.25s ease both;}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.dg-item{background:rgba(255,255,255,0.03);border:1px solid rgba(247,199,0,0.06);border-radius:8px;padding:10px 14px;}
.dg-item .dg-lbl{font-size:0.68rem;color:rgba(100,116,139,0.7);margin-bottom:3px;font-weight:600;letter-spacing:0.5px;text-transform:uppercase;}
.dg-item .dg-val{font-size:0.88rem;font-weight:600;color:#e2e8f0;}
.hi-actions{display:flex;gap:8px;margin-top:14px;justify-content:flex-end;}
.export-bar{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.02);border:1px solid rgba(247,199,0,0.08);border-radius:12px;padding:14px 18px;}
.count-badge{font-family:'JetBrains Mono',monospace;font-size:0.82rem;color:rgba(100,116,139,0.8);}
.count-badge span{color:#F7C700;font-weight:700;}

@media(max-width:640px){
  .nav{padding:12px 16px;}
  .nav-logo .logo-sub{display:none;}
  .page{padding:24px 16px 60px;}
  .form-row.col2,.form-row.col3{grid-template-columns:1fr;}
  .detail-grid{grid-template-columns:1fr;}
  .tab-btn{padding:8px 12px;}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAXI-THEMED BACKGROUND (Lightweight) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div style="position:fixed;inset:0;z-index:0;background:linear-gradient(180deg,#07090f 0%,#0a0d18 60%,#07090f 100%);"></div>
<div style="position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse 55% 40% at 85% 5%,rgba(247,199,0,0.07) 0%,transparent 60%),radial-gradient(ellipse 50% 35% at 15% 80%,rgba(247,199,0,0.04) 0%,transparent 55%);pointer-events:none;"></div>
<div style="position:fixed;bottom:0;left:0;right:0;height:6px;z-index:0;background:#111420;border-top:1px solid rgba(247,199,0,0.08);"></div>
<div style="position:fixed;inset:0;z-index:0;background-image:linear-gradient(rgba(247,199,0,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(247,199,0,0.025) 1px,transparent 1px);background-size:65px 65px;pointer-events:none;"></div>
<canvas id="particleCanvas" style="position:fixed;inset:0;z-index:1;pointer-events:none;"></canvas>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="nav" style="position:sticky;top:0;z-index:200;">
  <div style="display:flex;align-items:center;gap:12px;">
    <a href="index.html" style="background:rgba(247,199,0,0.07);border:1px solid rgba(247,199,0,0.18);color:rgba(247,210,100,0.9);font-family:'Plus Jakarta Sans',sans-serif;font-size:0.8rem;font-weight:600;padding:8px 16px;border-radius:10px;cursor:pointer;transition:all 0.2s;text-decoration:none;display:inline-flex;align-items:center;gap:5px;">‚Üê Home</a>
    <div class="nav-logo">
      <div class="logo-icon">üöñ</div>
      Taxi Bill Calculator
      <span class="logo-sub">by Mohan Deist</span>
    </div>
  </div>
  <div class="tab-btns">
    <button class="tab-btn active" onclick="showTab('calculator', this)">‚úö New Entry</button>
    <button class="tab-btn" onclick="showTab('history', this)">üìã History</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CALCULATOR PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="tab-calculator">

  <!-- THEMED ILLUSTRATED HEADER BANNER -->
  <div style="background:rgba(247,199,0,0.05);border:1px solid rgba(247,199,0,0.12);border-radius:20px;padding:20px 24px;margin-bottom:22px;display:flex;align-items:center;gap:20px;overflow:hidden;position:relative;">
    <!-- Mini taxi illustration -->
    <svg width="110" height="70" viewBox="0 0 110 70" fill="none" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0;">
      <!-- Road -->
      <rect x="0" y="55" width="110" height="15" rx="2" fill="rgba(247,199,0,0.08)"/>
      <rect x="10" y="61" width="18" height="3" rx="1.5" fill="rgba(247,199,0,0.25)"/>
      <rect x="46" y="61" width="18" height="3" rx="1.5" fill="rgba(247,199,0,0.25)"/>
      <rect x="82" y="61" width="18" height="3" rx="1.5" fill="rgba(247,199,0,0.25)"/>
      <!-- Cab body -->
      <rect x="18" y="32" width="74" height="26" rx="5" fill="#F7C700"/>
      <!-- Cabin roof -->
      <rect x="28" y="16" width="50" height="24" rx="5" fill="#F7C700"/>
      <!-- Windows -->
      <rect x="32" y="19" width="18" height="16" rx="2.5" fill="rgba(160,230,255,0.8)"/>
      <rect x="54" y="19" width="18" height="16" rx="2.5" fill="rgba(160,230,255,0.8)"/>
      <!-- TAXI roof sign -->
      <rect x="38" y="10" width="24" height="9" rx="2" fill="#111"/>
      <text x="50" y="17.5" text-anchor="middle" fill="#F7C700" font-size="5.5" font-weight="800" font-family="monospace">TAXI</text>
      <!-- Wheels -->
      <circle cx="34" cy="59" r="7" fill="#1a1a2e"/><circle cx="34" cy="59" r="3.5" fill="#333"/><circle cx="34" cy="59" r="1.5" fill="#F7C700"/>
      <circle cx="76" cy="59" r="7" fill="#1a1a2e"/><circle cx="76" cy="59" r="3.5" fill="#333"/><circle cx="76" cy="59" r="1.5" fill="#F7C700"/>
      <!-- Headlight glow -->
      <ellipse cx="93" cy="42" rx="5" ry="3.5" fill="rgba(255,245,150,0.85)"/>
      <!-- Tail light -->
      <rect x="18" y="37" width="5" height="7" rx="1.5" fill="rgba(255,80,80,0.8)"/>
      <!-- Door line -->
      <line x1="55" y1="34" x2="55" y2="56" stroke="rgba(200,160,0,0.5)" stroke-width="1.5"/>
    </svg>
    <div>
      <div style="font-size:1.2rem;font-weight:800;color:#f1f5f9;letter-spacing:-0.3px;margin-bottom:4px;">New Bill Entry</div>
      <div style="font-size:0.82rem;color:rgba(148,163,184,0.7);line-height:1.5;">Fill in the journey details to calculate the payable amount. The meter never lies.</div>
    </div>
    <!-- Taxi meter decoration top-right -->
    <div style="margin-left:auto;flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:4px;">
      <svg width="52" height="52" viewBox="0 0 52 52" xmlns="http://www.w3.org/2000/svg">
        <rect x="4" y="8" width="44" height="36" rx="6" fill="rgba(247,199,0,0.08)" stroke="rgba(247,199,0,0.25)" stroke-width="1.5"/>
        <rect x="4" y="8" width="44" height="14" rx="6" fill="rgba(247,199,0,0.15)"/>
        <text x="26" y="20" text-anchor="middle" fill="#F7C700" font-size="7" font-weight="800" font-family="monospace">METER</text>
        <text x="26" y="34" text-anchor="middle" fill="#34d399" font-size="9" font-weight="800" font-family="monospace">‚Çπ ‚Äî</text>
        <rect x="18" y="40" width="16" height="4" rx="2" fill="rgba(247,199,0,0.2)"/>
      </svg>
    </div>
  </div>

  <div class="form-card">
    <div class="section-label">
      <!-- Passenger icon -->
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><circle cx="7" cy="4" r="3" fill="#F7C700"/><path d="M1 13c0-3.3 2.7-6 6-6s6 2.7 6 6" stroke="#F7C700" stroke-width="1.5" stroke-linecap="round"/></svg>
      Basic Information
    </div>
    <div class="form-row col2">
      <div>
        <label>Vendor Name</label>
        <select id="vendorSelect" onchange="handleVendorChange()">
          <option value="">‚Äî Select Vendor ‚Äî</option>
          <option>Mavi Tour &amp; Travels</option>
          <option>Samrat Taxi</option>
          <option>Mohan Travels</option>
          <option value="__other__">Other (enter name)</option>
        </select>
        <input type="text" id="vendorOther" class="hidden" placeholder="Enter vendor name‚Ä¶" style="margin-top:8px;"/>
      </div>
      <div>
        <label>Bill No.</label>
        <input type="text" id="billNo" placeholder="e.g. INV-2024-001"/>
      </div>
    </div>
    <div class="form-row col2">
      <div><label>Bill Date</label><input type="date" id="billDate"/></div>
      <div><label>Passenger Name(s)</label><input type="text" id="passengers" placeholder="e.g. Rajesh Kumar, Priya Singh"/></div>
    </div>
    <div class="form-row col2">
      <div><label>Destination</label><input type="text" id="destination" placeholder="e.g. Mussoorie, Agra"/></div>
      <div>
        <label>Purpose of Visit</label>
        <select id="purposeOfVisit" onchange="handlePurposeChange()">
          <option value="">‚Äî Select Purpose ‚Äî</option>
          <option value="Exam Observer">Exam Observer</option>
          <option value="Venue Audit">Venue Audit</option>
          <option value="Flying Squad">Flying Squad</option>
          <option value="Control Room Cab">Control Room Cab</option>
          <option value="__other__">Other (enter purpose)</option>
        </select>
        <input type="text" id="purposeOther" class="hidden" placeholder="Enter purpose‚Ä¶" style="margin-top:8px;"/>
      </div>
    </div>
  </div>

  <div class="form-card">
    <div class="section-label">
      <!-- Road/route icon -->
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M7 1v12M4 3l3-2 3 2M4 11l3 2 3-2" stroke="#F7C700" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7h3M9 7h3" stroke="#F7C700" stroke-width="1.5" stroke-linecap="round"/></svg>
      Journey Details
    </div>
    <div class="form-row col2">
      <div>
        <label>Type of Service</label>
        <select id="serviceType" onchange="handleServiceChange()">
          <option value="">‚Äî Select Service ‚Äî</option>
          <option value="local">Local</option>
          <option value="outstation_plain">Outstation (Plain)</option>
          <option value="outstation_hilly">Outstation (Hilly)</option>
        </select>
      </div>
      <div>
        <label>Type of Vehicle</label>
        <select id="vehicleType" onchange="recalculate()">
          <option value="">‚Äî Select Vehicle ‚Äî</option>
          <option value="sedan">Sedan</option>
          <option value="crysta">Crysta</option>
        </select>
      </div>
    </div>
    <div class="form-row col2">
      <div><label>Journey Start (Date &amp; Time)</label><input type="datetime-local" id="journeyStart" onchange="recalculate()"/></div>
      <div><label>Journey End (Date &amp; Time)</label><input type="datetime-local" id="journeyEnd" onchange="recalculate()"/></div>
    </div>
    <div id="localFields" class="hidden">
      <div class="form-row col2">
        <div><label>Kilometers Travelled</label><input type="number" id="localKm" min="0" placeholder="e.g. 95" oninput="recalculate()"/></div>
        <div><label>Hours Used</label><input type="number" id="localHrs" min="0" step="0.5" placeholder="e.g. 9" oninput="recalculate()"/></div>
      </div>
    </div>
    <div id="outstationFields" class="hidden">
      <div class="form-row col1">
        <div><label>Total Kilometers Travelled</label><input type="number" id="outstationKm" min="0" placeholder="e.g. 320" oninput="recalculate()"/></div>
      </div>
    </div>
    <div class="form-row col1" style="margin-top:4px;">
      <div><label>Amount Claimed by Vendor (‚Çπ)</label><input type="number" id="vendorClaimed" min="0" placeholder="e.g. 3200" oninput="recalculate()"/></div>
    </div>
    <div class="form-row col2" style="margin-top:4px;">
      <div><label>GST (%)</label><input type="number" id="gstPercent" min="0" max="100" step="0.01" placeholder="e.g. 5 or 12" oninput="recalculate()"/></div>
      <div><label>Toll Tax / Parking (‚Çπ) <span class="hint">‚Äî GST not applicable</span></label><input type="number" id="tollParking" min="0" placeholder="e.g. 250" oninput="recalculate()"/></div>
    </div>
  </div>

  <div class="result-card hidden" id="resultCard">
    <div class="result-title">
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><rect x="1" y="3" width="12" height="9" rx="2" stroke="#F7C700" stroke-width="1.5"/><rect x="1" y="3" width="12" height="4" rx="2" fill="rgba(247,199,0,0.2)"/><rect x="4" y="9" width="6" height="2" rx="1" fill="#F7C700"/></svg>
      Fare Breakdown
    </div>
    <div id="resultLines"></div>
    <div class="payable-row">
      <div class="lbl">Amount Payable</div>
      <div class="val" id="payableAmount">‚Çπ0</div>
    </div>
    <div class="note-box hidden" id="noteBox"></div>
  </div>

  <div class="btn-row">
    <button class="btn btn-primary" onclick="recalculate()">‚ü≥ Calculate</button>
    <button class="btn btn-success hidden" id="saveBtn" onclick="saveEntry()">‚úì Save Entry</button>
    <button class="btn btn-outline" onclick="clearForm()">‚úï Clear</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORY PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="tab-history">
  <!-- THEMED HEADER BANNER -->
  <div style="background:rgba(247,199,0,0.05);border:1px solid rgba(247,199,0,0.12);border-radius:20px;padding:20px 24px;margin-bottom:22px;display:flex;align-items:center;gap:16px;">
    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" style="flex-shrink:0;">
      <rect x="6" y="4" width="36" height="40" rx="5" fill="rgba(247,199,0,0.08)" stroke="rgba(247,199,0,0.25)" stroke-width="1.5"/>
      <line x1="13" y1="14" x2="35" y2="14" stroke="#F7C700" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="13" y1="20" x2="35" y2="20" stroke="#F7C700" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="13" y1="26" x2="28" y2="26" stroke="#F7C700" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="13" y1="32" x2="32" y2="32" stroke="#F7C700" stroke-width="1.5" stroke-linecap="round"/>
      <!-- Taxi mini -->
      <rect x="26" y="27" width="16" height="9" rx="2" fill="#F7C700"/>
      <rect x="28" y="23" width="11" height="8" rx="1.5" fill="#F7C700"/>
      <circle cx="29" cy="37" r="2.5" fill="#1a1a2e"/><circle cx="39" cy="37" r="2.5" fill="#1a1a2e"/>
    </svg>
    <div>
      <div style="font-size:1.2rem;font-weight:800;color:#f1f5f9;letter-spacing:-0.3px;margin-bottom:4px;">Bill History</div>
      <div style="font-size:0.82rem;color:rgba(148,163,184,0.7);">All saved travel bills. Click any entry to expand full details.</div>
    </div>
  </div>
  <div class="export-bar">
    <span class="count-badge" id="countBadge">0 entries saved</span>
    <div style="display:flex;gap:8px;">
      <button class="btn btn-outline" onclick="exportCSV()">‚Üì Export CSV</button>
      <button class="btn btn-outline" onclick="exportJSON()">‚Üì Export JSON</button>
    </div>
  </div>
  <div id="historyList"></div>
</div>

<script>
const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbyOyOcN3uCi2Igug1EHQ5dslfjHSqWIS7vG4V4zRGLutqhAa1VU7BLwmtUrh8HOg34R8Q/exec';
let entries = JSON.parse(localStorage.getItem('travelbill_entries') || '[]');
let currentCalc = null;

function showTab(name, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  if (el) el.classList.add('active');
  if (name === 'calculator') clearForm();
  if (name === 'history') renderHistory();
}
function handleVendorChange() {
  const v = document.getElementById('vendorSelect').value;
  document.getElementById('vendorOther').classList.toggle('hidden', v !== '__other__');
}
function handlePurposeChange() {
  const v = document.getElementById('purposeOfVisit').value;
  document.getElementById('purposeOther').classList.toggle('hidden', v !== '__other__');
}
function getPurpose() {
  const sel = document.getElementById('purposeOfVisit').value;
  if (sel === '__other__') return document.getElementById('purposeOther').value.trim();
  return sel;
}
function handleServiceChange() {
  const svc = document.getElementById('serviceType').value;
  document.getElementById('localFields').classList.toggle('hidden', svc !== 'local');
  document.getElementById('outstationFields').classList.toggle('hidden', !svc.startsWith('outstation'));
  recalculate();
}
function getVendorName() {
  const sel = document.getElementById('vendorSelect');
  if (sel.value === '__other__') return document.getElementById('vendorOther').value.trim();
  if (sel.value === '') return '';
  return sel.options[sel.selectedIndex].text;
}
function isNightTime(dt) { if (!dt) return false; const h = dt.getHours(); return h >= 22 || h < 6; }
function checkNightAllowance(s, e) { if (!s || !e) return false; return isNightTime(new Date(s)) || isNightTime(new Date(e)); }
function getDaysBetween(s, e) {
  if (!s || !e) return 0;
  const start = new Date(s), end = new Date(e);
  if (end - start <= 0) return 0;
  const sd = new Date(start.getFullYear(), start.getMonth(), start.getDate());
  const ed = new Date(end.getFullYear(), end.getMonth(), end.getDate());
  return Math.floor((ed - sd) / 86400000);
}

function recalculate() {
  const svc = document.getElementById('serviceType').value;
  const veh = document.getElementById('vehicleType').value;
  const claimed = parseFloat(document.getElementById('vendorClaimed').value) || 0;
  const startStr = document.getElementById('journeyStart').value;
  const endStr = document.getElementById('journeyEnd').value;
  if (!svc || !veh) { hideResult(); return; }
  let breakdown = [], calculated = 0, notes = [];
  if (svc === 'local') {
    const km = parseFloat(document.getElementById('localKm').value) || 0;
    const hrs = parseFloat(document.getElementById('localHrs').value) || 0;
    if (!km && !hrs) { hideResult(); return; }
    const baseKm = 80, baseHrs = 8;
    let baseRate, extraKmRate, extraHrRate;
    if (veh === 'sedan') { baseRate = 2100; extraKmRate = 18; extraHrRate = 150; }
    else { baseRate = 2500; extraKmRate = 24; extraHrRate = 225; }
    breakdown.push({ lbl: `Base Package (${baseHrs} hrs / ${baseKm} km)`, val: `‚Çπ${baseRate.toLocaleString()}` });
    calculated += baseRate;
    const extraKm = Math.max(0, km - baseKm);
    if (extraKm > 0) { const a = extraKm * extraKmRate; breakdown.push({ lbl: `Extra Km: ${extraKm} km √ó ‚Çπ${extraKmRate}`, val: `+‚Çπ${a.toLocaleString()}` }); calculated += a; }
    const extraHrs = Math.max(0, hrs - baseHrs);
    if (extraHrs > 0) { const a = extraHrs * extraHrRate; breakdown.push({ lbl: `Extra Hours: ${extraHrs} hrs √ó ‚Çπ${extraHrRate}`, val: `+‚Çπ${a.toLocaleString()}` }); calculated += a; }
  } else {
    const km = parseFloat(document.getElementById('outstationKm').value) || 0;
    if (!km) { hideResult(); return; }
    const pricePerKm = svc === 'outstation_plain' ? (veh === 'sedan' ? 18 : 24) : (veh === 'sedan' ? 21 : 28);
    const minKm = 250;
    const tripDays = Math.max(1, getDaysBetween(startStr, endStr) + 1);
    const minKmTotal = minKm * tripDays;
    const billedKm = Math.max(km, minKmTotal);
    const kmCharge = billedKm * pricePerKm;
    if (km < minKmTotal) {
      notes.push(`Minimum billing: ${minKm} km/day √ó ${tripDays} day${tripDays > 1 ? 's' : ''} = ${minKmTotal} km (actual: ${km} km)`);
      breakdown.push({ lbl: `Distance: ${minKmTotal} km (min ${minKm}√ó${tripDays}d) √ó ‚Çπ${pricePerKm}/km`, val: `‚Çπ${kmCharge.toLocaleString()}` });
    } else {
      breakdown.push({ lbl: `Distance: ${km} km √ó ‚Çπ${pricePerKm}/km`, val: `‚Çπ${kmCharge.toLocaleString()}` });
    }
    calculated += kmCharge;
    if (checkNightAllowance(startStr, endStr)) { breakdown.push({ lbl: 'Night Allowance (before 6AM / after 10PM)', val: '+‚Çπ300', cls: 'yellow' }); calculated += 300; notes.push('Night allowance applied.'); }
    const holdDays = getDaysBetween(startStr, endStr);
    if (holdDays > 0) { const a = holdDays * 300; breakdown.push({ lbl: `Vehicle Holding (${holdDays} day${holdDays > 1 ? 's' : ''} √ó ‚Çπ300)`, val: `+‚Çπ${a.toLocaleString()}`, cls: 'yellow' }); calculated += a; notes.push(`Vehicle holding: ${holdDays} night(s) √ó ‚Çπ300.`); }
  }
  const gstPercent = parseFloat(document.getElementById('gstPercent').value) || 0;
  const tollParking = parseFloat(document.getElementById('tollParking').value) || 0;
  breakdown.push({ divider: true });
  breakdown.push({ lbl: 'Sub-total (Transport)', val: `‚Çπ${calculated.toLocaleString()}`, cls: 'green' });
  let gstAmount = 0;
  if (gstPercent > 0) { gstAmount = Math.round(calculated * gstPercent / 100); breakdown.push({ lbl: `GST @ ${gstPercent}%`, val: `+‚Çπ${gstAmount.toLocaleString()}`, cls: 'yellow' }); }
  const calculatedWithGST = calculated + gstAmount;
  if (tollParking > 0) breakdown.push({ lbl: 'Toll / Parking (GST exempt)', val: `+‚Çπ${tollParking.toLocaleString()}`, cls: 'yellow' });
  const calculatedTotal = calculatedWithGST + tollParking;
  if (claimed > 0) {
    breakdown.push({ divider: true });
    const diff = claimed - calculatedTotal;
    breakdown.push({ lbl: 'Vendor Claimed', val: `‚Çπ${claimed.toLocaleString()}`, cls: diff > 0 ? 'red' : 'green' });
    breakdown.push({ lbl: 'Calculated Total', val: `‚Çπ${calculatedTotal.toLocaleString()}`, cls: 'green' });
    if (diff > 0) notes.push(`Vendor claimed ‚Çπ${diff.toLocaleString()} more than calculated.`);
    if (diff < 0) notes.push(`Vendor claimed ‚Çπ${Math.abs(diff).toLocaleString()} less than calculated.`);
  }
  const payable = claimed > 0 ? Math.min(calculatedTotal, claimed) : calculatedTotal;
  currentCalc = { vendor: getVendorName(), billNo: document.getElementById('billNo').value.trim(), billDate: document.getElementById('billDate').value, passengers: document.getElementById('passengers').value.trim(), destination: document.getElementById('destination').value.trim(), purposeOfVisit: getPurpose(), serviceType: svc, vehicleType: veh, journeyStart: startStr, journeyEnd: endStr, km: svc === 'local' ? (parseFloat(document.getElementById('localKm').value)||0) : (parseFloat(document.getElementById('outstationKm').value)||0), hrs: svc === 'local' ? (parseFloat(document.getElementById('localHrs').value)||0) : null, vendorClaimed: claimed, gstPercent, gstAmount, tollParking, calculatedAmount: calculated, calculatedTotal, payableAmount: payable, breakdown, notes, savedAt: null };
  showResult(breakdown, payable, notes);
}

function showResult(breakdown, payable, notes) {
  document.getElementById('resultCard').classList.remove('hidden');
  document.getElementById('saveBtn').classList.remove('hidden');
  document.getElementById('payableAmount').textContent = '‚Çπ' + payable.toLocaleString();
  const rl = document.getElementById('resultLines');
  rl.innerHTML = '';
  breakdown.forEach(b => {
    if (b.divider) { const hr = document.createElement('hr'); hr.className = 'divider-line'; rl.appendChild(hr); return; }
    const row = document.createElement('div'); row.className = 'result-line';
    row.innerHTML = `<span class="lbl">${b.lbl}</span><span class="val ${b.cls||''}">${b.val}</span>`;
    rl.appendChild(row);
  });
  const nb = document.getElementById('noteBox');
  if (notes.length) { nb.classList.remove('hidden'); nb.innerHTML = '<strong>‚Ñπ Notes:</strong><ul>' + notes.map(n=>`<li>${n}</li>`).join('') + '</ul>'; }
  else nb.classList.add('hidden');
}

function hideResult() { document.getElementById('resultCard').classList.add('hidden'); document.getElementById('saveBtn').classList.add('hidden'); currentCalc = null; }

function saveEntry() {
  if (!currentCalc) return;
  const vendorName = getVendorName();
  if (!vendorName) { alert('Please select a vendor.'); return; }
  if (!document.getElementById('billNo').value.trim()) { alert('Please enter a Bill No.'); return; }
  currentCalc.vendor = vendorName;
  currentCalc.savedAt = new Date().toISOString();
  currentCalc.id = Date.now();
  entries.unshift(currentCalc);
  localStorage.setItem('travelbill_entries', JSON.stringify(entries));
  const btn = document.getElementById('saveBtn');
  if (GOOGLE_SHEET_URL) {
    btn.textContent = '‚è≥ Saving‚Ä¶'; btn.disabled = true;
    fetch(GOOGLE_SHEET_URL, { method:'POST', body:JSON.stringify(currentCalc), headers:{'Content-Type':'application/json'}, mode:'no-cors' })
    .then(()=>{ btn.textContent='‚úì Saved to Sheet!'; btn.style.background=''; btn.disabled=false; setTimeout(()=>{btn.textContent='‚úì Save Entry';},3000); })
    .catch(()=>{ btn.textContent='‚úì Saved locally'; btn.disabled=false; setTimeout(()=>{btn.textContent='‚úì Save Entry';},3000); });
  } else { btn.textContent='‚úì Saved!'; setTimeout(()=>{btn.textContent='‚úì Save Entry';},2000); }
}

function clearForm() {
  ['purposeOfVisit','vendorSelect','billDate','billNo','passengers','destination','serviceType','vehicleType','journeyStart','journeyEnd','localKm','localHrs','outstationKm','vendorClaimed','gstPercent','tollParking'].forEach(id=>document.getElementById(id).value='');
  ['vendorOther','purposeOther'].forEach(id=>{document.getElementById(id).value='';document.getElementById(id).classList.add('hidden');});
  ['localFields','outstationFields'].forEach(id=>document.getElementById(id).classList.add('hidden'));
  hideResult();
}

function svcLabel(s) { return {local:'Local',outstation_plain:'Outstation (Plain)',outstation_hilly:'Outstation (Hilly)'}[s]||s; }
function fmtDt(str) { if(!str) return '‚Äî'; return new Date(str).toLocaleString('en-IN',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'}); }

function renderHistory() {
  const list = document.getElementById('historyList');
  const badge = document.getElementById('countBadge');
  badge.innerHTML = `<span>${entries.length}</span> entr${entries.length===1?'y':'ies'} saved`;
  if (!entries.length) { list.innerHTML=`<div class="history-empty"><div class="icon">üöñ</div><div>No entries saved yet.</div><div style="margin-top:8px;font-size:0.82rem;">Calculate and save a bill to see it here.</div></div>`; return; }
  list.innerHTML='';
  entries.forEach((e,i)=>{
    const item=document.createElement('div'); item.className='history-item'; item.id='hi_'+i;
    const saved=new Date(e.savedAt).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
    const diff=e.vendorClaimed?e.vendorClaimed-e.calculatedAmount:0;
    const diffTag=e.vendorClaimed?(diff>0?`<span class="tag">Saved ‚Çπ${diff.toLocaleString()}</span>`:(diff<0?`<span class="tag green">Vendor Under-billed</span>`:'')):'';
    item.innerHTML=`
      <div class="hi-top" onclick="toggleExpand(${i})">
        <div class="hi-meta">
          <div class="hi-bill">üöñ Bill #${e.billNo||'‚Äî'} ¬∑ ${e.billDate?new Date(e.billDate).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'}):saved}</div>
          <div class="hi-title">${e.vendor||'‚Äî'} ‚Üí ${e.destination||'‚Äî'}</div>
          <div class="hi-tags">
            <span class="tag">${svcLabel(e.serviceType)}</span>
            <span class="tag">${e.vehicleType==='sedan'?'üöó Sedan':'üöô Crysta'}</span>
            ${e.purposeOfVisit?`<span class="tag yellow">üéØ ${e.purposeOfVisit}`:``}
            ${e.passengers?`<span class="tag teal">üë§ ${e.passengers}</span>`:''}
            ${diffTag}
          </div>
        </div>
        <div class="hi-amount"><div class="payable">‚Çπ${e.payableAmount.toLocaleString()}</div><div class="label">Payable</div></div>
      </div>
      <div class="hi-detail" id="hid_${i}">
        <div class="detail-grid">
          <div class="dg-item"><div class="dg-lbl">Bill No.</div><div class="dg-val">${e.billNo||'‚Äî'}</div></div>
          <div class="dg-item"><div class="dg-lbl">Bill Date</div><div class="dg-val">${e.billDate?new Date(e.billDate).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'}):'‚Äî'}</div></div>
          <div class="dg-item"><div class="dg-lbl">Passengers</div><div class="dg-val">${e.passengers||'‚Äî'}</div></div>
          <div class="dg-item"><div class="dg-lbl">Purpose</div><div class="dg-val">${e.purposeOfVisit||'‚Äî'}</div></div>
          <div class="dg-item"><div class="dg-lbl">Destination</div><div class="dg-val">${e.destination||'‚Äî'}</div></div>
          <div class="dg-item"><div class="dg-lbl">Journey Start</div><div class="dg-val">${fmtDt(e.journeyStart)}</div></div>
          <div class="dg-item"><div class="dg-lbl">Journey End</div><div class="dg-val">${fmtDt(e.journeyEnd)}</div></div>
          <div class="dg-item"><div class="dg-lbl">Km Travelled</div><div class="dg-val">${e.km} km</div></div>
          ${e.hrs!==null?`<div class="dg-item"><div class="dg-lbl">Hours Used</div><div class="dg-val">${e.hrs} hrs</div></div>`:''}
          <div class="dg-item"><div class="dg-lbl">Vendor Claimed</div><div class="dg-val">‚Çπ${e.vendorClaimed?e.vendorClaimed.toLocaleString():'‚Äî'}</div></div>
          <div class="dg-item"><div class="dg-lbl">Transport Sub-total</div><div class="dg-val">‚Çπ${e.calculatedAmount.toLocaleString()}</div></div>
          ${e.gstPercent?`<div class="dg-item"><div class="dg-lbl">GST (${e.gstPercent}%)</div><div class="dg-val">‚Çπ${(e.gstAmount||0).toLocaleString()}</div></div>`:''}
          ${e.tollParking?`<div class="dg-item"><div class="dg-lbl">Toll / Parking</div><div class="dg-val">‚Çπ${e.tollParking.toLocaleString()}</div></div>`:''}
          <div class="dg-item"><div class="dg-lbl">Calculated Total</div><div class="dg-val">‚Çπ${(e.calculatedTotal||e.calculatedAmount).toLocaleString()}</div></div>
          <div class="dg-item"><div class="dg-lbl" style="color:#F7C700">Amount Payable</div><div class="dg-val" style="color:#F7C700;font-size:1.1rem;">‚Çπ${e.payableAmount.toLocaleString()}</div></div>
        </div>
        ${e.notes&&e.notes.length?`<div class="note-box" style="margin-top:12px;">${e.notes.map(n=>`‚Ä¢ ${n}`).join('<br/>')}</div>`:''}
        <div class="hi-actions"><button class="btn btn-danger" onclick="deleteEntry(${i})">üóë Delete</button></div>
      </div>`;
    list.appendChild(item);
  });
}

function toggleExpand(i) {
  const detail=document.getElementById('hid_'+i), item=document.getElementById('hi_'+i);
  const isOpen=detail.classList.contains('show');
  document.querySelectorAll('.hi-detail').forEach(d=>d.classList.remove('show'));
  document.querySelectorAll('.history-item').forEach(d=>d.classList.remove('expanded'));
  if(!isOpen){detail.classList.add('show');item.classList.add('expanded');}
}
function deleteEntry(i) { if(!confirm('Delete this entry?')) return; entries.splice(i,1); localStorage.setItem('travelbill_entries',JSON.stringify(entries)); renderHistory(); }
function exportCSV() {
  if(!entries.length){alert('No entries to export.');return;}
  const headers=['ID','Saved Date','Vendor','Bill No','Bill Date','Passengers','Purpose','Destination','Service','Vehicle','Journey Start','Journey End','Km','Hours','Vendor Claimed','Transport Sub-total','GST %','GST Amount','Toll/Parking','Calculated Total','Payable Amount'];
  const rows=entries.map(e=>[e.id,new Date(e.savedAt).toLocaleString('en-IN'),e.vendor,e.billNo,e.billDate||'',e.passengers,e.purposeOfVisit||'',e.destination,svcLabel(e.serviceType),e.vehicleType==='sedan'?'Sedan':'Crysta',fmtDt(e.journeyStart),fmtDt(e.journeyEnd),e.km,e.hrs??'',e.vendorClaimed,e.calculatedAmount,e.gstPercent??0,e.gstAmount??0,e.tollParking??0,e.calculatedTotal??e.calculatedAmount,e.payableAmount].map(v=>`"${String(v??'').replace(/"/g,'""')}"`));
  const csv=[headers.join(','),...rows.map(r=>r.join(','))].join('\n');
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download='travelbill_export.csv'; a.click();
}
function exportJSON() { if(!entries.length){alert('No entries to export.');return;} const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(entries,null,2)],{type:'application/json'})); a.download='travelbill_export.json'; a.click(); }
</script>

<script>
// YELLOW TAXI PARTICLE CONSTELLATION
const pc=document.getElementById('particleCanvas'),cx=pc.getContext('2d');
let PW,PH,pts=[];
function rz(){PW=pc.width=window.innerWidth;PH=pc.height=window.innerHeight;}
rz();window.addEventListener('resize',rz);
class Pt{
  constructor(){this.reset();}
  reset(){this.x=Math.random()*PW;this.y=Math.random()*PH*(0.75);this.r=Math.random()*1.5+0.3;this.vx=(Math.random()-.5)*.3;this.vy=(Math.random()-.5)*.2;this.a=Math.random()*.45+0.1;this.c=['#F7C700','#f59e0b','#fbbf24','#fff7aa','#fffde0'][Math.floor(Math.random()*5)];}
  update(){this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>PW||this.y<0||this.y>PH)this.reset();}
  draw(){cx.beginPath();cx.arc(this.x,this.y,this.r,0,Math.PI*2);cx.fillStyle=this.c;cx.globalAlpha=this.a;cx.fill();cx.globalAlpha=1;}
}
for(let i=0;i<60;i++)pts.push(new Pt());
function anim(){
  cx.clearRect(0,0,PW,PH);
  for(let i=0;i<pts.length;i++)for(let j=i+1;j<pts.length;j++){
    const dx=pts[i].x-pts[j].x,dy=pts[i].y-pts[j].y,d=Math.sqrt(dx*dx+dy*dy);
    if(d<100){cx.beginPath();cx.moveTo(pts[i].x,pts[i].y);cx.lineTo(pts[j].x,pts[j].y);cx.strokeStyle='#F7C700';cx.globalAlpha=(1-d/100)*.06;cx.lineWidth=.5;cx.stroke();cx.globalAlpha=1;}
  }
  pts.forEach(p=>{p.update();p.draw();});
  requestAnimationFrame(anim);
}
anim();
</script>
</body>
</html>
